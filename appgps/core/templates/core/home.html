{% extends "core/layout.html" %}
{% load static %}

{% block title %}Ajustes de usuario{% endblock %}

{% block head %}
    <link href="{% static 'core/css/home.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'core/js/mapa.js'%}" type="text/js">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

{% endblock %}
{% block content %}
<div  class="ratio ratio-16x9">
    
    <h1>MAPA</h1> 
    <form id="formRegistro" method="post">
        {% csrf_token %}
        <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2174.3150122290667!2d-71.21335322204507!3d-33.69433560376429!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1ses-419!2scl!4v1666291482908!5m2!1ses-419!2scl" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" id="mapa"></iframe> -->

        <div >
            <a class="btn btn-info" id="arrendar" href="{% url 'arriendo'%}">Arrendar</a>
            <a class="btn btn-info" id="btnbuscar" href="#">Buscar</a>
            <button type="submit" class="form-control" id="btnbuscar" name="AllCordenadas" onclick="AllLocation(this.value)">Biciletas de Melipilla</button>

        </div>
        
        







    <div id="map_container"></div>
    <div id="map"></div>
    <script>
            var map;
            function initMap(zoomeLevel, latDb, longDb) {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: -33.69417055239359, lng: -71.21368835681287 },
                    zoom: zoomeLevel != null ? zoomeLevel : 14,
                    mapId: "b7011240b82da652",
                });
                
            }
            // // var map = new google.maps.Map(document.getElementById('map'), {
            // // zoom: 15,
            // // center: new google.maps.LatLng(-33.69417055239359, -71.21368835681287),
            // // mapId: "b7011240b82da652",
            // });
            // var infowindow = new google.maps.InfoWindow();
            // var marker, i;
            // for (i = 0; i < marcadores.length; i++) {  
            //     marker = new google.maps.Marker({
            //     position: new google.maps.LatLng(marcadores[i][1], marcadores[i][2]),
            //     map: map
            //     });
            //     google.maps.event.addListener(marker, 'click', (function(marker, i) {
            //     return function() {
            //         infowindow.setContent(marcadores[i][0]);
            //         infowindow.open(map, marker);
            //     }
            //     })(marker, i));
            // }

            function AllLocation(ListaCoordenadas) {
                
                    //Ruta de las imagenes donde estan los iconos del marcador
                    // var iconName = "../Icons/three.png";
                    $.each(ListaCoordenadas, function (i, dato) {
                        console.log("funca");
                        console.log(ListaCoordenadas);
                        
                        marker = new google.maps.Marker({
                            position: { lat: dato.lat, lng: dato.lng },
                            map: map,
                            //Si desean pueden dejar por defectos el marcador, comentando la linea de abajo
                            //icon: iconName
                            
                        });
                        
                    });


            }
           
            // //FUNCION PARA CARGAR TODAS
            // function AllLocation() {
            //     $.ajax({
            //         Type: 'GET',
            //         url: '@Url.Action("GetAllLocation")',
            //         dataType: 'json',
            //         success: function (ListaCoordenadas) {
            //             //Ruta de las imagenes donde estan los iconos del marcador
            //             var iconName = "../Icons/three.png";
            //             $.each(ListaCoordenadas, function (i, dato) {

            //                 console.log(ListaCoordenadas);

            //                 marker = new google.maps.Marker({
            //                     position: { lat: dato.Lat, lng: dato.Long },
            //                     map: map,
            //                     //Si desean pueden dejar por defectos el marcador, comentando la linea de abajo
            //                     //icon: iconName
            //                 });

            //             });

            //         }

            //     })
            // google.maps.event.addDomListener(window, 'load', initialize);
            </script>
         <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBSm8z4EyxJx90791A-iCmoNLQFY-7F9k&callback=initMap" async defer></script>

    </form>
</div>
{% endblock %}

<!-- <script>
    //Funcion inicial (coordenadas por defecto)
    var map;
    function initMap(zoomeLevel, latDb, longDb) {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: latDb != null ? latDb : -33.686114, lng: longDb != null ? longDb : -71.215991 },
            zoom: zoomeLevel != null ? zoomeLevel : 14
        });
    }

    //FUNCION PARA CARGAR TODAS
    function AllLocation() {
        $.ajax({
            Type: 'GET',
            url: '@Url.Action("GetAllLocation")',
            dataType: 'json',
            success: function (ListaCoordenadas) {
                //Ruta de las imagenes donde estan los iconos del marcador
                var iconName = "../Icons/three.png";
                $.each(ListaCoordenadas, function (i, dato) {

                    console.log(ListaCoordenadas);

                    marker = new google.maps.Marker({
                        position: { lat: dato.Lat, lng: dato.Long },
                        map: map,
                        //Si desean pueden dejar por defectos el marcador, comentando la linea de abajo
                        //icon: iconName
                    });

                });

            }

        })


    }
    //FUNCION PARA CARGAR POR ID
    function LocationById(locationId) {
        $.get("/Home/GetAllLocationById?id=" + locationId, function (data, status) {
            //Dependiendo el rating (dato de la tabla), mostara un icono diferente
            var iconName = data.Rating == 1 ? "../Icons/one.png" : data.Rating == 2 ? "../Icons/two.png" : "../Icons/three.png";
            initMap(data.Zoom, data.Lat, data.Long);
            marker = new google.maps.Marker({
                position: { lat: data.Lat, lng: data.Long },
                map: map,
                icon: iconName
            });
        })
    }


</script>

 -->
